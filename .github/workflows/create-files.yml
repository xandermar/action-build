name: Create Files from Articles

on:
  push:
    branches:
      - main

jobs:
  create-files:
    runs-on: ubuntu-latest
    steps:
      # Checkout repository
      - name: Checkout repository
        uses: actions/checkout@v2

      # Set up Node.js (for reading and parsing the JSON file)
      - name: Set up Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '16'

      # Install jq for JSON parsing (if you need jq for additional operations)
      - name: Install jq
        run: sudo apt-get install jq

      # Read articles.json and process each article
      - name: Create files for each article
        run: |
          # Read the articles.json file and parse it
          ARTICLES=$(cat articles.json)

          # Loop through each article and create the files
          for row in $(echo "$ARTICLES" | jq -r '.[] | @base64'); do
            _jq() {
              echo ${row} | base64 --decode | jq -r ${1}
            }

            # Get the article path and HTML content
            path=$(_jq '.path')
            html=$(_jq '.html')

            # Create the directories if necessary
            mkdir -p "./output/$path"

            # Write the HTML content to the file
            echo "$html" > "./output/$path/index.html"
          done
          
          # Optionally, print the result for debugging purposes
          echo "Files created in ./output"
